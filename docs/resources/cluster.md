---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "tdh_cluster Resource - tdh"
subcategory: ""
description: |-
  Represents a service instance or cluster. Some attributes are used only once for creation, they are: dedicated, network_policy_ids, cluster_metadata.
  Changing only tags is supported at the moment. If you wish to update network policies associated with it, please refer resource: tdh_cluster_network_policies_association.
---

# tdh_cluster (Resource)

Represents a service instance or cluster. Some attributes are used only once for creation, they are: `dedicated`, `network_policy_ids`, `cluster_metadata`.
Changing only `tags` is supported at the moment. If you wish to update network policies associated with it, please refer resource: `tdh_cluster_network_policies_association`.

## Example Usage

```terraform
data "tdh_provider_types" "all" {
}
data "tdh_instance_types" "pg" {
  service_type = local.service_type
}
locals {
  service_type        = "POSTGRES"
  provider_type       = "tkgs"                   # can be get using datasource "tdh_provider_types"
  instance_type       = "XX-SMALL"               # can be get using datasource "tdh_instance_types"
  version             = "postgres-13"            # TBD
  storage_policy_name = "tdh-k8s-cluster-policy" # can be get using datasource
}
data "tdh_regions" "shared" {
  instance_size = local.instance_type
  provider_type = local.provider_type
}
data "tdh_object_storages" "all" {
}
data "tdh_network_ports" "all" {
}
// to get the storage policies and eligible data planes for the given provider
data "tdh_eligible_data_planes" "all" {
  provider_name = "tkgs"
}

output "data" {
  value = {
    providers       = data.tdh_provider_types.all
    instance_types  = data.tdh_instance_types.pg
    regions         = data.tdh_regions.shared
    object_storages = data.tdh_object_storages.all
    network_ports   = data.tdh_network_ports.all
    data_planes     = data.tdh_eligible_data_planes.all
  }
}

resource "tdh_network_policy" "network" {
  name         = "tf-pg-nw-policy"
  service_type = "NETWORK"
  network_spec = {
    cidr             = "0.0.0.0/32",
    network_port_ids = [
      for port in data.tdh_network_ports.all.network_ports : port.id if strcontains(port.id, "postgres")
    ]
  }
}

resource "tdh_cluster" "test" {
  name                = "tf-pg-cls"
  service_type        = "POSTGRES"
  provider_type       = "tkgs"
  instance_size       = "XX-SMALL"
  region              = "REGION_NAME"  # can get using datasource "tdh_regions"
  data_plane_id       = "DP_ID" # can get using datasource "tdh_eligible_data_planes"
  network_policy_ids  = [tdh_network_policy.network.id]
  tags                = ["tdh-tf", "new-tag"]
  version             = local.version
  storage_policy_name = "tdh-k8s-cluster-policy" # complete list can be get using datasource "tdh_eligible_data_planes"
  cluster_metadata    = {
    username      = "test"
    password      = "Admin!23"
    database      = "test"
    objectStoreId = "OBJECT_STORE_ID" # can be used from its datasource
  }
  // non editable fields
  lifecycle {
    ignore_changes = [instance_size, name, provider_type, region, service_type]
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cluster_metadata` (Attributes) Additional info for the cluster. (see [below for nested schema](#nestedatt--cluster_metadata))
- `data_plane_id` (String) ID of the data-plane where the cluster is running.
- `instance_size` (String) Size of instance. Supported values: `XX-SMALL`, `X-SMALL`, `SMALL`, `LARGE`, `XX-LARGE`.
Please make use of datasource `tdh_network_ports` to decide on a size based on resources it requires.
- `name` (String) Name of the cluster.
- `network_policy_ids` (Set of String) IDs of network policies to attach to the cluster.
- `provider_type` (String) Short-code of provider to use for data-plane. Ex: `tkgs`, `tkgm` . Complete list can be seen using datasource `tdh_provider_types`.
- `region` (String) Region of data plane. Supported values can be seen using datasource `tdh_regions`.
- `storage_policy_name` (String) Name of the storage policy for the cluster.
- `version` (String) Version of the cluster.

### Optional

- `dedicated` (Boolean) If present and set to `true`, the cluster will get deployed on a dedicated data-plane in current Org.
- `service_type` (String) Type of TDH Cluster to be created. Supported values: `POSTGRES`, `MYSQL`, `RABBITMQ`, `REDIS` .
 Default is `POSTGRES`.
- `shared` (Boolean) If present and set to `true`, the cluster will get deployed on a shared data-plane in current Org.
- `tags` (Set of String) Set of tags or labels to categorise the cluster.
- `upgrade` (Attributes) To create the backup or not while upgrading (see [below for nested schema](#nestedatt--upgrade))

### Read-Only

- `created` (String) Creation time of the cluster.
- `id` (String) ID of the cluster.
- `last_updated` (String) Time when the cluster was last modified.
- `metadata` (Attributes) Additional info of the cluster. (see [below for nested schema](#nestedatt--metadata))
- `org_id` (String) ID of the Org which owns the cluster.
- `status` (String) Status of the cluster.

<a id="nestedatt--cluster_metadata"></a>
### Nested Schema for `cluster_metadata`

Required:

- `password` (String) Password for the cluster.
- `username` (String) Username for the cluster.

Optional:

- `database` (String) Database name in the cluster.
- `extensions` (Set of String) Set of extensions to be enabled on the cluster.
- `object_storage_id` (String) ID of the object storage for backup operations.
- `restore_from` (String) Restore from a specific backup.


<a id="nestedatt--upgrade"></a>
### Nested Schema for `upgrade`

Optional:

- `omit_backup` (Boolean) set to take backup before upgrade
- `target_version` (String) To Upgrade version


<a id="nestedatt--metadata"></a>
### Nested Schema for `metadata`

Optional:

- `object_storage_id` (String) ID of the object storage for backup operations.

Read-Only:

- `cluster_name` (String) Name of the cluster.
- `connection_uri` (String) Connection URI to the instance.
- `manager_uri` (String) URI of the manager.
- `metrics_endpoints` (Set of String) List of metrics endpoints exposed on the instance.

## Import

Import is supported using the following syntax:

```shell
# Cluster can be imported by specifying the UUID.
terraform import tdh_cluster.example d3c49288-7b17-4e78-a6af-257b49e34e53
```
